<div class="single-product-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-section">
    <div class="container">
      <div class="text-center py-5">
        <div class="spinner-border text-primary spinner-large" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 text-muted">Loading product details...</p>
      </div>
    </div>
  </div>

  <!-- Product Details -->
  <div *ngIf="!isLoading && product" class="product-details">
    <!-- Breadcrumb -->
    <div class="breadcrumb-section">
      <div class="container">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a (click)="navigateToProducts()" class="breadcrumb-link">Products</a>
            </li>
            <li class="breadcrumb-item">
              <a (click)="navigateToProducts()" class="breadcrumb-link">{{ product.category | titlecase }}</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
          </ol>
        </nav>
      </div>
    </div>

    <!-- Product Info Section -->
    <div class="container my-5">
      <div class="row g-5">
        <!-- Product Image -->
        <div class="col-lg-6">
          <div class="product-image-section">
            <div class="main-image-container">
              <img [src]="getCurrentImage()" [alt]="product.title" class="main-product-image">
              <div class="image-actions">
                <button class="btn btn-light btn-sm image-action-btn" (click)="shareProduct()" title="Share Product">
                  üì§
                </button>
              </div>
              <!-- Multiple Images Gallery -->
              <div class="image-gallery mt-3" *ngIf="product.images && product.images.length > 1">
                <div class="row">
                  <div class="col-3" *ngFor="let image of product.images.slice(0, 4); let i = index">
                    <img [src]="image" [alt]="product.title" 
                         class="gallery-image" 
                         [class.active]="selectedImageIndex === i"
                         (click)="selectImage(i)">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Information -->
        <div class="col-lg-6">
          <div class="product-info-section">
            <!-- Category Badge -->
            <div class="product-category-badge">
              <span class="badge bg-primary">{{ product.category | titlecase }}</span>
            </div>

            <!-- Product Title -->
            <h1 class="product-title">{{ product.title }}</h1>

            <!-- Rating -->
            <div class="product-rating mb-4">
              <div class="stars">
                <span *ngFor="let star of getStarArray(product.rating)" 
                      [innerHTML]="star ? '‚≠ê' : '‚òÜ'"></span>
                <span *ngIf="getHalfStar(product.rating)">‚≠ê</span>
              </div>
              <span class="rating-text ms-2">
                <!-- <ng-container *ngIf="typeof product.rating === 'object'; else simpleRating">
                  {{ product.rating.rate | number:'1.1-1' }}
                  <span class="text-muted">({{ product.rating.count }} reviews)</span>
                </ng-container> -->
                <ng-template #simpleRating>
                  <!-- {{ product.rating | number:'1.1-1' }} -->
                  <span class="text-muted">({{ math.floor(math.random() * 1000) + 50 }} reviews)</span>
                </ng-template>
              </span>
            </div>

            <!-- Price -->
            <div class="product-price mb-4">
              <div class="price-container">
                <span class="current-price" *ngIf="!hasDiscount()">${{ product.price | number:'1.2-2' }}</span>
                <div *ngIf="hasDiscount()" class="discount-price-container">
                  <span class="discounted-price">${{ getDiscountedPrice() | number:'1.2-2' }}</span>
                  <span class="original-price">${{ product.price | number:'1.2-2' }}</span>
                  <span class="discount-badge">{{ product.discountPercentage | number:'1.0-0' }}% OFF</span>
                </div>
              </div>
              <!-- Stock Info -->
              <div class="stock-info mt-2" *ngIf="product.stock">
                <span class="badge" [class]="product.stock > 10 ? 'bg-success' : 'bg-warning'">
                  {{ product.stock > 10 ? 'In Stock' : 'Only ' + product.stock + ' left' }}
                </span>
              </div>
            </div>

            <!-- Description -->
            <div class="product-description mb-4">
              <h5 class="description-title">Description</h5>
              <p class="description-text">{{ product.description }}</p>
            </div>

            <!-- Quantity Selector -->
            <div class="quantity-section mb-4">
              <h6 class="quantity-label">Quantity</h6>
              <div class="quantity-controls">
                <button class="btn btn-outline-secondary quantity-btn" 
                        (click)="decrementQuantity()" 
                        [disabled]="quantity <= 1">
                  ‚ûñ
                </button>
                <span class="quantity-display">{{ quantity }}</span>
                <button class="btn btn-outline-secondary quantity-btn" 
                        (click)="incrementQuantity()" 
                        [disabled]="quantity >= 10">
                  ‚ûï
                </button>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="product-actions">
              <button class="btn btn-outline-secondary btn-lg back-btn" (click)="goBack()">
                ‚¨ÖÔ∏è Back
              </button>
            </div>

            <!-- Product Features -->
            <div class="product-features mt-5">
              <div class="row">
                <div class="col-4 text-center">
                  <div class="feature-item">
                    <div class="feature-icon">üöö</div>
                    <p class="feature-text">Free Shipping</p>
                  </div>
                </div>
                <div class="col-4 text-center">
                  <div class="feature-item">
                    <div class="feature-icon">üîÑ</div>
                    <p class="feature-text">Easy Returns</p>
                  </div>
                </div>
                <div class="col-4 text-center">
                  <div class="feature-item">
                    <div class="feature-icon">üõ°Ô∏è</div>
                    <p class="feature-text">Warranty</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Related Products Section -->
    <div class="related-products-section py-5 bg-light">
      <div class="container">
        <h3 class="section-title text-center mb-5">Related Products</h3>
        
        <!-- Loading Related Products -->
        <div *ngIf="isLoadingRelated" class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading related products...</span>
          </div>
        </div>

        <!-- Related Products Grid -->
        <div *ngIf="!isLoadingRelated && relatedProducts.length > 0" class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
          <div class="col" *ngFor="let relatedProduct of relatedProducts">
            <div class="related-product-card" (click)="navigateToProduct(relatedProduct.id)">
              <div class="related-product-image">
                <img [src]="relatedProduct.image || relatedProduct.thumbnail" [alt]="relatedProduct.title" class="img-fluid">
              </div>
              <div class="related-product-info">
                <h6 class="related-product-title">
                  {{ relatedProduct.title.length > 40 ? (relatedProduct.title | slice:0:40) + '...' : relatedProduct.title }}
                </h6>
                <div class="related-product-rating">
                  ‚≠ê
                  <span *ngIf="typeof relatedProduct.rating === 'object'; else simpleRelatedRating">
                    <!-- {{ relatedProduct.rating.rate | number:'1.1-1' }} -->
                  </span>
                  <ng-template #simpleRelatedRating>
                    <!-- <span>{{ relatedProduct.rating | number:'1.1-1' }}</span> -->
                  </ng-template>
                </div>
                <div class="related-product-price">
                  ${{ relatedProduct.price | number:'1.2-2' }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Related Products -->
        <div *ngIf="!isLoadingRelated && relatedProducts.length === 0" class="text-center">
          <p class="text-muted">No related products found.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Not Found -->
  <div *ngIf="!isLoading && !product" class="not-found-section">
    <div class="container">
      <div class="text-center py-5">
        <div class="text-warning mb-4" style="font-size: 4rem;">‚ö†Ô∏è</div>
        <h3>Product Not Found</h3>
        <p class="text-muted mb-4">The product you're looking for doesn't exist or has been removed.</p>
        <button class="btn btn-primary btn-lg" (click)="navigateToProducts()">
          ‚¨ÖÔ∏è Back to Products
        </button>
      </div>
    </div>
  </div>
</div>